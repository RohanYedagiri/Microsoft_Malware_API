from flask import Flask, jsonify, request
from flask_restful import Resource, Api
from pickle import load
import pandas as pd
import numpy as np
import sklearn

app = Flask(__name__)
api = Api(app)



class Predict(Resource):
    def post(self):

        # step1: get the data
        feats = request.get_json()
        sepal_length = feats['sepal_length']
        sepal_width = feats['sepal_width']
        petal_length = feats['petal_length']
        petal_width = feats['petal_width']

        """
        Example input for the api:
        {
            "sepal_length":3,
            "sepal_width":2.3,
            "petal_length":1.5,
            "petal_width":2.6
        }
        """

        # step2: load the model
        gbm = load(open('iris_model.sav', 'rb'))

        # step3: predict the output
        a = [sepal_length, sepal_width, petal_length, petal_width]
        a = np.array(a).reshape(1, -1)
        species = gbm.predict(a)
        species = species[0]

        # step4: return result json
        result = {
            'Status': 'Success',
            'Species': species
        }

        return jsonify(result)


api.add_resource(Predict,'/predict')

"""

@app.route('/add', methods=['POST'])
def add():
    dataDict = request.get_json()
    x = dataDict['x']
    y = dataDict['y']

    z = x+y
    res = {
        'message':200,
        'result':z
    }

    return jsonify(res)
"""


if __name__ == '__main__':
    app.run(debug=True)
